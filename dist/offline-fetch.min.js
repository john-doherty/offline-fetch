/*!
 * offline-fetch - v1.1.0
 * Adds offline support to window.fetch
 * https://github.com/john-doherty/offline-fetch
 * @author John Doherty <www.johndoherty.info>
 * @license MIT
 */
!function(){"use strict";function e(e,n){if(!e||""===e)return Promise.reject(new Error("Please provide a URL"));if(void 0!==n&&"object"!=typeof n)return Promise.reject(new Error("If defined, options must be of type object"));if(!fetch)return Promise.reject(new Error("fetch not supported, are you missing the window.fetch polyfill?"));if(!n||!n.offline)return fetch(e,n);var o="object"!=typeof n.offline?{}:n.offline,r=window[o.storage||"sessionStorage"],i=parseInt(o.timeout||"10000",10),f=parseInt(o.retries||"-1",10),s=parseInt(o.retryDelay||"-1",10),c="number"==typeof o.expires?o.expires:-1,u=!0===o.renew,a=!0===o.debug,l=n.method||"GET",h=navigator&&!1===navigator.onLine,m="offline:"+function(e){var t=0;if(0===e.length)return t;for(var n=0,o=e.length;n<o;n++){var r=e.charCodeAt(n);t=(t<<5)-t+r,t&=t}return t}(l+"|"+e),p="function"==typeof n.offline.cacheKeyGenerator?n.offline.cacheKeyGenerator(e,n,m):m;return Object.keys(n||{}).forEach(function(e){null===n[e]&&delete n[e]}),Promise.resolve(r.getItem(p)).then(function(o){o="string"==typeof o?JSON.parse(o):o;var l=null;o&&(l=new Response(o.content,{status:o.status,statusText:o.statusText,headers:{"Content-Type":o.contentType}}));var m,d,y=!!(o&&c>0)&&Date.now()-o.storedAt>c;return l&&h?(a&&t("offlineFetch[cache] (offline): "+e),Promise.resolve(l)):!l||y||u?(m=i,d=fetch(e,n),new Promise(function(e,t){var n=setTimeout(function(){t(new Error("Promise Timed Out"))},m);d.then(function(t){clearTimeout(n),e(t)}).catch(function(e){clearTimeout(n),t(e)})})).then(function(n){if(n.status>=200&&n.status<=299){var o=n.headers.get("Content-Type")||"";(o.match(/application\/json/i)||o.match(/text\//i))&&n.clone().text().then(function(e){var t=JSON.stringify({status:n.status,statusText:n.statusText,contentType:o,content:e,storedAt:Date.now()});r.setItem(p,t)})}return a&&t("offlineFetch[live]: "+e),n}).catch(function(o){var r=o.message||"",i="Promise Timed Out"===r;return i&&l?(a&&t("offlineFetch[cache] (timedout): "+e),Promise.resolve(l)):!i&&f?(a&&t("offlineFetch["+r+"] (retrying): "+e),function(e,n,o,r,i){return o=o||3,r=r||1e3,new Promise(function(f,s){var c=function(u){i&&t("offlineFetch[retrying] ("+u+" of "+o+"): "+e),fetch(e,n).then(function(e){f(e)}).catch(function(e){u>0?setTimeout(function(){c(--u)},r):s(e)})};c(o)})}(e,n,f,s,a)):Promise.reject(o)}):(a&&t("offlineFetch[cache]: "+e),Promise.resolve(l))})}function t(e){console&&console.log&&console.log(e)}"undefined"==typeof window?module.exports=e:window.offlineFetch=e}();