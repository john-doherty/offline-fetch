/*!
 * offline-fetch - v1.0.0
 * Adds offline support to window.fetch
 * https://github.com/john-doherty/offline-fetch
 * @author John Doherty <www.johndoherty.info>
 * @license MIT
 */
!function(){"use strict";function e(e,i){if(!e||""===e)return Promise.reject(new Error("Please provide a URL"));if(void 0!==i&&"object"!=typeof i)return Promise.reject(new Error("If defined, options must be of type object"));if(!fetch)return Promise.reject(new Error("fetch not supported, are you missing the window.fetch polyfill?"));if(!i||!i.offline)return fetch(e,i);var s="object"!=typeof i.offline?{}:i.offline,c=window[s.storage||"sessionStorage"],f=parseInt(s.timeout||"10000",10),u=parseInt(s.retries||"-1",10),a=parseInt(s.retryDelay||"-1",10),l="number"==typeof s.expires?s.expires:-1,h=!0===s.renew,m=!0===s.debug,p=i.method||"GET",d=!1===navigator.onLine,y="offline:"+o(p+"|"+e),w="function"==typeof i.cacheKeyGenerator?i.cacheKeyGenerator(e,i,y):y;return Promise.resolve(c.getItem(w)).then(function(o){var s=null;(o="string"==typeof o?JSON.parse(o):o)&&(s=new Response(o.content,{status:o.status,statusText:o.statusText,headers:{"Content-Type":o.contentType}}));var p=!!(o&&l>0)&&Date.now()-o.storedAt>l;return s&&d?(m&&n("offlineFetch[cache] (offline): "+e),Promise.resolve(s)):!s||p||h?r(f,fetch(e,i)).then(function(t){if(t.status>=200&&t.status<=299){var o=t.headers.get("Content-Type")||"";(o.match(/application\/json/i)||o.match(/text\//i))&&t.clone().text().then(function(e){c.setItem(w,{status:t.status,statusText:t.statusText,contentType:o,content:e,storedAt:Date.now()})})}return m&&n("offlineFetch[live]: "+e),t}).catch(function(o){var r=o.message||"",c="Promise Timed Out"===r;return c&&s?(m&&n("offlineFetch[cache] (timedout): "+e),Promise.resolve(s)):!c&&u?(m&&n("offlineFetch["+r+"] (retrying): "+e),t(e,i,u,a,m)):Promise.reject(o)}):(m&&n("offlineFetch[cache]: "+e),Promise.resolve(s))})}function t(e,t,o,r,i){return o=o||3,r=r||1e3,new Promise(function(s,c){var f=function(u){i&&n("offlineFetch[retrying] ("+u+" of "+o+"): "+e),fetch(e,t).then(function(e){s(e)}).catch(function(e){u>0?setTimeout(function(){f(--u)},r):c(e)})};f(o)})}function n(e){console&&console.log&&console.log(e)}function o(e){var t=0;if(0===e.length)return t;for(var n=0,o=e.length;n<o;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return t}function r(e,t){return new Promise(function(n,o){var r=setTimeout(function(){o(new Error("Promise Timed Out"))},e);t.then(function(e){clearTimeout(r),n(e)}).catch(function(e){clearTimeout(r),o(e)})})}"undefined"==typeof window?module.exports=e:window.offlineFetch=e}();